!function(e){var n=function(n,t){var o=/^(.*)(\d)+$/i,l=e(n),c={limit:999,cloneThis:".toclone",valueClone:!1,dataClone:!1,deepClone:!1,cloneButton:".clone",deleteButton:".delete",clonePosition:"after",serializeID:!0,ignore:"label.error",defaultRender:!1,preserveChildCount:!1},r=e.extend(c,t||{});this.getOption=function(){return r},this.setOption=function(n){e.extend(r,n||{})},l.find(r.cloneThis).addClass("cloneya"),e.extend(r,{childCount:l.find(r.cloneThis).length}),l.find(r.cloneButton).length&&l.on("click",r.cloneButton,function(n){n.preventDefault(),l.triggerHandler("clone_clone",[e(this)])}),l.on("clone_clone",function(n,t){$toclone=t.closest(r.cloneThis);var o=$toclone.siblings().add($toclone).length;if(o<r.limit){if(l.triggerHandler("clone_before_clone",[$toclone]),$newclone=$toclone.clone({withDataAndEvents:r.dataClone,deepWithDataAndEvents:r.deepClone}),"false"!==r.preserveChildCount){var i=$newclone.find(".cloneya"),c=i.slice(r.childCount,i.length);c.remove()}$newclone.find("input, textarea, select").each(function(){a(e(this)),l.triggerHandler("clone_form_input",[e(this),$toclone,$newclone])}),l.triggerHandler("clone_after_clone",[$toclone,$newclone]),l.triggerHandler("clone_before_append",[$toclone,$newclone]),"after"!==r.clonePosition?$toclone.before($newclone):$toclone.after($newclone),r.ignore&&$newclone.find(r.ignore).remove(),d(),l.triggerHandler("clone_after_append",[$toclone,$newclone])}else l.triggerHandler("clone_limit",r.limit,[$toclone])}),l.find(r.cloneButton).length&&l.on("click",r.deleteButton,function(n){n.preventDefault(),l.triggerHandler("clone_delete",[e(this)])}),l.on("clone_delete",function(n,t){$todelete=t.closest(r.cloneThis);var o=$todelete.siblings().add($todelete).length;e.when(l.triggerHandler("clone_before_delete",[$todelete,o])).done(function(){l.triggerHandler("clone_after_delete")})}),l.on("clone_before_delete",function(n,t,o){o>1?e(t).remove():t.find("input, textarea, select").each(function(){a(e(this))})});var a=function(e){r.valueClone||e.hasClass("noEmpty")||(e.is(":checkbox")||e.is(":radio")?e.prop("checked",!1):e.val(""))},d=function(){r.serializeID===!0&&(mainid=l.find(r.cloneThis).first().attr("id"),l.find(r.cloneThis).each(function(n){j=0!==n?n:"",e(this).attr("id")&&e(this).attr("id",mainid+j);var t,l;e(this).find("*").each(function(){if(t=e(this).attr("id")){var i=t.match(o);i&&3===i.length?(l=t.replace(/\d+$/,"")+j,e(this).attr("id",l)):(l=t+j,e(this).attr("id",l))}e(this).closest(r.cloneThis).find("label[for='"+t+"']").attr("for",l);var c=e(this).attr("name");if(c){var a=c.match(/\[([^}]+)\]/);if(a&&a.length>=1){var d=c;c=[].map.call(d,function(e,t){return isNaN(+e)||"["!==d[t-1]||"]"!==d[t+1]?e:n}).join(""),e(this).attr("name",c)}}})}))};if(r.defaultRender)for(i=1;i<r.defaultRender;i++)e(r.cloneButton).last().trigger("click")};e.fn.cloneya=function(t){return this.each(function(){var o=e(this);if(!o.data("cloneya")){var l=new n(this,t);o.data("cloneya",l)}})}}(jQuery);